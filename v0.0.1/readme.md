## モールス信号用可変BPFオーディオフィルター 仕様書 v0.0.1

### 1. 設計目的

* 用途: モールス信号(400-2000Hz)の聞き取り改善
* 処理: リアルタイムDSP可変バンドパスフィルタ
* 遅延: <10ms (要求 <200ms)
* 音質: 高S/N比、低歪み

### 2. システム構成

* MCU: Raspberry Pi Pico (RP2040)
* 処理: モノラル、リアルタイム
* 電源: USB給電またはVSYS 5V入力
* 特徴: 4次Butterworth多重帰還型アンチエイリアシングLPF

### 3. 入出力仕様

#### 3.1 入力部

* コネクタ: 3.5mmモノラルジャック (Tip=信号, Sleeve=GND)
* 入力インピーダンス: 10kΩ
* 最大入力振幅: ±1V (1.65Vバイアス中心)
* 周波数帯域: 20Hz-20kHz
* プリアンプ: 可変ゲイン 1-11倍 (RV1)

#### 3.2 出力部

* コネクタ: 3.5mmモノラルジャック
* 出力インピーダンス: <100Ω
* 最大出力振幅: ±1V (1.65Vバイアス中心)
* 負荷: 32Ω以上推奨
* 音量調整: 可変抵抗 RV4 10kΩ

#### 3.3 制御部

* 可変抵抗: 3本 + 入力ゲイン用 1本

  * 入力ゲイン (RV1) 1-11倍
  * BPF下限周波数 (RV3, GPIO28)
  * BPF上限周波数 (RV2, GPIO27)
  * 出力音量 (RV4)

### 4. デジタル処理仕様

#### 4.1 ADC仕様

* 分解能: 12bit (0-4095)
* サンプリング周波数: 16kHz
* 入力方式: 内蔵ADC + DMA + タイマ割込み
* 基準電圧: 1.65V 中点 (AGND基準)
* 入力チャネル: GPIO26 (ADC0)

#### 4.2 DSP処理

* フィルタ構成: 双2次IIR ×2段 → 4次可変BPF
* 特性: Butterworth特性
* 制御周波数範囲: 下限400-上限2000Hz
* バッファサイズ: 32サンプル (2ms)
* 全処理遅延: 約5ms

#### 4.3 DAC仕様

* IC: MCP4921 (12bit SPI DAC)
* 分解能: 12bit (0-4095)
* 出力電圧範囲: 0-3.3V (1.65V中心)
* 更新レート: 16kHz 同期
* SPI信号: CS=GPIO1, SCK=GPIO2, SDI=GPIO3

### 5. アナログ回路仕様

#### 5.1 プリアンプ部

* IC: NJM4580 (U1C)
* 構成: 非反転増幅器
* ゲイン: 1-11倍 (RV1)
* 帯域幅: DC-100kHz
* S/N比: >65dB
* バイアス: 1.65V (単電源動作)

#### 5.2 アンチエイリアシングLPF（4次Butterworth多重帰還型）

* IC: NJM4580 (U2A, U2B)
* 構成: 多重帰還型第2次フィルタ ×2段
* カットオフ周波数: 3.0kHz (@-3dB)
* 8kHzでの減衰量: 約-34.1dB
* Q値: 0.707 (Butterworth)
* 部品定数例:

  * 1段目: R5=11kΩ, R6=11kΩ, C3=100nF, C4=100nF
  * 2段目: R7=11kΩ, R9=11kΩ, C6=100nF, C7=100nF

#### 5.3 出力アンプ部

* IC: NJM4580 (U1B)
* 構成: 非反転バッファ
* ゲイン: 1倍
* 出力インピーダンス: <100Ω
* バイアス: 1.65V

#### 5.4 バイアス電圧生成

* 分圧抵抗: R11=10kΩ, R12=10kΩ
* 出力: 1.65V
* AGND: アナログ専用GND (Raspberry Pi Pico pin33)

#### 5.5 電源・デカップリング

* 電源電圧: 3.3V (Raspberry Pi Pico 3V3)
* デカップリング: 各IC Vcc-AGND 間に 100nF

### 6. 性能仕様

| 周波数 | 通過特性      | 用途・効果               |
| ------ | ------------- | ------------             |
| 400Hz  | BPF下限       | モールス信号下限周波数   |
| 800Hz  | BPF中心       | 信号中心周波数           |
| 1200Hz | BPF上限       | モールス信号上限周波数   |
| 3.0kHz | -3dB (LPF fc) | アンチエイリアシング開始 |
| 8kHz   | -34.1dB       | エイリアシング抑制       |
| 12kHz  | -46dB         | 高調波抑制               |

* S/N比: >70dB (AGND効果含む)
* THD: <0.5% (1kHz, 0.5Vrms)
* 総遅延: <10ms
* 消費電流: <100mA (Pico込み)
* 動作温度: 0-50℃

### 7. 部品構成・概算コスト

* 半導体: Pi-Pico, NJM4580×2, MCP4921
* 受動部品: 抵抗, コンデンサ, 可変抵抗
* 概算総コスト: 約3,000円

部品表

| リファレンス                         | 数量   | 値               | 説明                                                  | 単価    | 小計     |
| -------------                        | ------ | ----             | ----                                                  | ------  | ------   |
| A1                                   | 1      | RaspberryPi_Pico | Raspberry Pi Pico マイコンボード                      | \770    | \770     |
| C1,C2,C3,C8                          | 4      | 100n             | メタライズドポリエステルフィルムコンデンサ 0.1μF 100V | \20     | \80      |
| C4,C6                                | 2      | 10n              | メタライズドポリエステルフィルムコンデンサ 10nF 100V  | \20     | \40      |
| C5,C7                                | 2      | 1.5n             | フィルムコンデンサ 1500pF 50V (ルビコンF2D)           | \10     | \20      |
| C9                                   | 1      | 10u              | オーディオ用電解コンデンサ 10μF 25V                   | \20     | \20      |
| C10                                  | 1      | 100u             | オーディオ用電解コンデンサ 100μF 25V 85℃ (ニチコンFG) | \20     | \20      |
| J1,J2                                | 2      | AudioJack4       | 4極オーディオジャック                                 | \100    | \200     |
| R1,R2,R3,R4,R5,R7,R8,R10,R11,R12,R13 | 11     | 10k              | 小型金属皮膜抵抗 10kΩ 1/4W                            | \2.5    | \27.5    |
| R6                                   | 1      | 18k              | 小型金属皮膜抵抗 18kΩ 1/4W                            | \2.5    | \2.5     |
| R9                                   | 1      | 47k              | 小型金属皮膜抵抗 47kΩ 1/4W                            | \2.5    | \2.5     |
| R14,R15                              | 2      | 100              | 小型金属皮膜抵抗 100Ω 1/4W                            | \2.5    | \5       |
| RV1,RV4                              | 2      | 10k              | 基板用薄型ボリューム 10kΩB                            | \60     | \240     |
| RV2,RV3                              | 2      | 10k              | 基板用薄型ボリューム 10kΩA                            | \60     | \240     |
| U1,U2                                | 2      | NJM4580          | オーディオ用デュアルオペアンプ                        | \120    | \240     |
| U3                                   | 1      | MCP4921          | 12bit SPI DAコンバータ                                | \330    | \330     |

* OPアンプ はフィルタ設計で重要なGBWマージンを確保するため、GBW ? 9 MHz の NJM4580 を採用。部品許容差が特性に影響しやすいため抵抗は±1 %、コンデンサは温度係数の低いMLCCを推奨します。
* 可変抵抗 はBカーブ（対数）を使用し、モールス信号の聞き取りに適した可変幅を実現。RV1はプリアンプゲイン、RV2/RV3はLPF段の上下限調整、RV4は最終出力音量に割り当てます。
* コンデンサ はフィルタ用とデカップリング用を兼用し、計7個の0.1 μFを配置。デジタル部とアナログ部でAGNDを分離し、C9でPi Pico AGNDへデカップリングします。
* 電解コンデンサ は出力カップリング（C10）とDCバイアス安定化（C11）に使用。音質への影響を抑えるため低ESR品を選定してください。
* オーディオジャック は基板実装型でTip/Sleeveの配線を明確に。負荷32 Ω以上を想定し、インピーダンスマッチングに優れた部品を選びます。
* マイコン はRaspberry Pi Picoを使用し、ADC/DAC制御・DSP処理・SPI制御を一台で担います。


### 8. 実装概要

* 試作: ブレッドボード段階的テスト
* 最終実装: ユニバーサル基板, AGND専用レイアウト
* 機能: ADC DMA + タイマ割込み, DSP, SPI DAC, 可変抵抗読み込み

